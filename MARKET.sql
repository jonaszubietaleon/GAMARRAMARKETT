
----------------borrar tablas -------------------

drop table VENTA;
drop table PERSONA;
drop table VENTA_DETALLE;
drop table PRODUCTO;
drop table CATEGORIA;


---------CREAR LA TABLA  PERSONA
CREATE TABLE PERSONA (
    IDPER int  NOT NULL,
    DNIPER char(8)  NOT NULL,
    NOMPER varchar2(50)  NOT NULL,
    APEPER varchar2(50)  NOT NULL,
    EMAPER varchar2(80)  NOT NULL,
    CELPER char(9)  NOT NULL,
    TIPPER char(1)  NOT NULL,
    ESTPER char(1) DEFAULT 'A' NOT NULL,
    FECNACPER DATE NOT NULL,
    CONSTRAINT PERSONA_pk PRIMARY KEY (IDPER)
) ;
---------CREAR LA TABLA  CATEGORIA
CREATE TABLE CATEGORIA(
    IDCAT INT NOT NULL,
    NOMCAT varchar2(50)  NOT NULL,
    CONSTRAINT CATEGORIA_pk PRIMARY KEY (IDCAT)
);
---------CREAR LA TABLA  PRODUCTO
CREATE TABLE PRODUCTO(
    CODPROD varchar2(50)  NOT NULL,
    NOMPRO varchar2(50)  NOT NULL,
    PREPRO decimal(8,2)  NOT NULL,
    STOCKPRO int NOT NULL,
    IDCATPRO int NOT NULL,
    ESTPRO char(1) DEFAULT 'A' NOT NULL,
    CONSTRAINT PRODUCTO_pk PRIMARY KEY (CODPROD)
);
---------CREAR LA TABLA  VENTA
CREATE TABLE VENTA(
    IDVEN INT NOT NULL,
    FECVEN date NOT NULL,
    IDVEND int NOT NULL,
    IDCLI int NOT NULL,
    TIPPAGVEN char(1)  NOT NULL,
    ESTVEN char(1) DEFAULT 'A' NOT NULL,
    CONSTRAINT VENTA_pk PRIMARY KEY (IDVEN)
);
---------CREAR LA TABLA  VENTA_DETALLE
CREATE TABLE VENTA_DETALLE(
    IDVENDET INT NOT NULL,
    IDVEN int NOT NULL,
    CODPRO varchar2(50)  NOT NULL,
    CANVENDET NUMBER NOT NULL,
    CONSTRAINT VENTA_DETALLE_pk PRIMARY KEY (IDVENDET)
);
-------------------------------------------------------------------RELACIONES DE LA TABLAS---------------------------------------------------------
ALTER TABLE PRODUCTO ADD CONSTRAINT PRODUCTO_CATEGORIA
    FOREIGN KEY (IDCATPRO)
    REFERENCES CATEGORIA (IDCAT);
    
ALTER TABLE VENTA ADD CONSTRAINT VENTA_VENDEDOR
    FOREIGN KEY (IDVEND)
    REFERENCES PERSONA (IDPER);

ALTER TABLE VENTA ADD CONSTRAINT VENTA_CLIENTE
    FOREIGN KEY (IDCLI)
    REFERENCES PERSONA (IDPER);
    
ALTER TABLE VENTA_DETALLE ADD CONSTRAINT VENTA_DETALLE_VENTA
    FOREIGN KEY (IDVEN)
    REFERENCES VENTA (IDVEN);
    
ALTER TABLE VENTA_DETALLE ADD CONSTRAINT VENTA_DETALLE_PRODUCTO
    FOREIGN KEY (CODPRO)
    REFERENCES PRODUCTO (CODPROD);

-------------------------------------------------------------------SECUENCIAS---------------------------------------------------------  
  
CREATE SEQUENCE INC_PER
START WITH 200
INCREMENT BY 1;

CREATE SEQUENCE INC_CAT
START WITH 10
INCREMENT BY 10;

CREATE SEQUENCE INC_VEN
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE INC_VEN_DET
START WITH 300
INCREMENT BY 1;
-------------------------------------------------------------------TRIGGERS-----------------------------------------------------------------

CREATE TRIGGER TRG_INC_PER
  BEFORE INSERT ON PERSONA
  FOR EACH ROW
  BEGIN
    SELECT INC_PER.NEXTVAL INTO :NEW.IDPER FROM DUAL;
  END;
  /
  
  CREATE TRIGGER TRG_INC_CAT
  BEFORE INSERT ON CATEGORIA
  FOR EACH ROW
  BEGIN
    SELECT INC_CAT.NEXTVAL INTO :NEW.IDCAT FROM DUAL;
  END;
  /
  
  CREATE TRIGGER TRG_INC_VEN
  BEFORE INSERT ON VENTA
  FOR EACH ROW
  BEGIN
    SELECT INC_VEN.NEXTVAL INTO :NEW.IDVEN FROM DUAL;
  END;
  /
  
  CREATE TRIGGER TRG_INC_VENDET
  BEFORE INSERT ON VENTA_DETALLE
  FOR EACH ROW
  BEGIN
    SELECT INC_VEN_DET.NEXTVAL INTO :NEW.IDVENDET FROM DUAL;
  END;
  /
  
create or replace trigger INSERTAR_FECHA  
 BEFORE insert on VENTA 
 for each row  
 begin
   :NEW.FECVEN := to_char(sysdate, 'DD/MM/YYYY HH24:MI:SS'); 
end;
/

/* Insertar registros en la tabla PERSONA */
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('77889955', 'Alberto', 'Solano Pariona', 'alberto.pariona@empresa.com', '99845632', 'V', '10/02/1970');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('45781233', 'Alicia', 'García Campos', '', '', 'C', '20/03/1980');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15487922', 'Juana', 'Ávila Chumpitaz', 'juana.avila@gmail.com', '923568741', 'C', '06/06/1986');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('22116633', 'Ana', 'Enrique Flores', 'ana.enrique@empresa.com', '', 'V', '10/02/1970');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88741235', 'Claudia', 'Perales Ortiz', 'caludia.peralez@yahoo.com', '997865042', 'c', '25/07/1981');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('45122587', 'Mario', 'Barios Martinez', 'mario.barrios@outblook.com', '986737101', 'c', '10/10/1987');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15257021', 'Brunela', 'Tarazona Guerra', 'brunela.tarazona@gmail.com', '995234667', 'c', '06/06/1990');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('47141236', 'Alejandro', 'Jimenez Huapaya', '', '941525650', 'c', '01/05/1991');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15352585', 'Claudia', 'Marquez Litano', 'caludia.marquez@gmail.com', '985814723', 'c', '01/10/1987');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88741235', 'Mario', 'Rodrigez Mayo', 'mario.rodrigez@outblok.com', '997865042', 'c', '25/07/1988');       
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('87951237', 'Luisa', 'Guerra Ibarra', 'luisa.guerra@outblok.com', '997865042', 'c', '25/07/1995');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('74149824', 'Perdo Alberto', 'Candela  Venezuela', 'pedro.candela@gmail.com', '997865042', 'c', '25/07/1975');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('52290134', 'Angel Manuel', 'Rojas Avila', 'angelo.rojas@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('11451598', 'Hilardo Faviano', 'Avila Huapalla', '', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('75749031', 'Octavio Adan ', 'Marquez Osorio', 'octavio.marquez@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('55869138', 'Manolo Enrique ', 'Vazquez Saravia', 'manolo.vazquez@outblok.com', '997865042', 'c', '25/07/2000');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('41568245', 'Genova Pilar ', 'Ortiz Quizpe', 'genova.ortiz@outblok.com', '997865042', 'c', '12/04/2003');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('49835621', 'Oscar Cesar ', 'Quioz Savala', '', '988264986', 'c', '12/10/2004');
INSERT INTO PERSONA (DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('44994841', 'Veronica ', 'Romero Vargas ', 'Veronica.romero@outblok.com', '', 'c', '25/08/2002');



/* Insertar registros en la tabla categoria */
INSERT INTO categoria (NOMCAT) VALUES ('Abarrotes');
INSERT INTO categoria (NOMCAT) VALUES ('Carne y Pollo');
INSERT INTO categoria (NOMCAT) VALUES ('Higiene y Limpieza');
INSERT INTO categoria (NOMCAT) VALUES ('Bebidas y licores ');
INSERT INTO categoria (NOMCAT) VALUES ('Dulces y snacks ');
INSERT INTO categoria (NOMCAT) VALUES ('Electrodomesticos');


/* Insertar registros en la tabla producto */
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P01','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P02','Azucar','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P03','Pollo fresco','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P04','Lomo Fino','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P05','Detergente Opal','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P06','Suavisante Ariel','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P07','Six pack cerveza en lata','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P08','Pack Jhonnie Waker Black','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P09','Ron Barcelo gran Añejo','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P10','Fliete de Pechuga','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P11','Deditos de Pechuga de pollo','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P13','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P14','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P15','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P16','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P17','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P18','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P19','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P20','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P21','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P22','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P23','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P24','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P25','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P26','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P27','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P28','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P29','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P30','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P31','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P32','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P33','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P34','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P35','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P36','Arroz','4,65','50','10','A');
INSERT INTO PRODUCTO (CODPRO, NOMPRO, PREPRO, STOCKPRO, IDCATPRO, ESTPRO) VALUES ('P37','Arroz','4,65','50','10','A');

/* Insertar la tabla venta */
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN)VALUES ('25/04/2023','200','202','E');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN)VALUES ('25/04/2023','200','204','T');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN)VALUES ('25/04/2023','203','205','T');
INSERT INTO VENTA (FECVEN, IDVEND, IDCLI, TIPPAGVEN)VALUES ('25/04/2023','203','206','E');

/* INSERTAR REGISTROS EN LA TABLA VENTA_DETALLE */
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('1','P01','2');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('1','P04','4');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('2','P06','12');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('2','P08','6');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('2','P11','16');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('3','P15','8');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('4','P09','5');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('4','P14','13');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('4','P20','10');
INSERT INTO VENTA_DETALLE(IDVEN, CODPRO, CANVENDET) VALUES ('4','P21','13');

/* Actualizar el número de celular de Mario Rodríguez Martínez por el número 922881101. */

UPDATE  persona
SET CELPER = 922881101
WHERE IDPER = 209;

/* El cliente de DNI 53298147 ya cuenta con número de celular es: 977226604 */

UPDATE  persona
SET CELPER = 977226604
WHERE IDPER = 212;

/* Eliminar lógicamente los clientes cuyo DNI son: 11453265, 15487922 y 49985471 */

UPDATE  persona
SET ESTPER = 'I'
WHERE IDPER = 202;

UPDATE  persona
SET ESTPER = 'I'
WHERE IDPER = 213;

UPDATE  persona
SET ESTPER = 'I'
WHERE IDPER = 217;


/* Los clientes cuyos DNI son: 87952514, 55869321 y 74142585 han perdido su celular por tanto debe estar en blanco. */

UPDATE  persona
SET CELPER = NULL
WHERE IDPER = 210;

UPDATE  persona
SET CELPER = NULL
WHERE IDPER = 211;

UPDATE  persona
SET CELPER = NULL
WHERE IDPER = 215;

/* El cliente Oscar César Quiroz Zavala será reactivado y debemos actualizar su nuevo correo: oscar.quiroz@yahoo.es. */

UPDATE  persona
SET EMAPER = 'oscar.quiroz@yahoo.es'
WHERE IDPER = 217;

/* Agregar los datos de los siguientes clientes y vendedor. */

INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('88225463','Gustavo Tadeo','Quizpe Solorzano','gustavo.quispe@gmail.com','null','V','13/10/2001');
INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('15753595','Daniela','Solis Vargas','daniela.soliz@outlook.com','null','C','09/11/1993');
INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('76314895','Milton Gregorio','Vasquez Iturrizaga','milton.gregorio@yahoo.es','974815233','C','22/06/2004');
INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('84725001','Veronica','Ancajima Araujo','veronica.ancajima@yahoo.com','null','C','07/11/1980');
INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('11228514','Felicita','Marroquin Candela','felicita.marroquin@outlook.com','966001472','V','06/06/2006');
INSERT INTO PERSONA(DNIPER, NOMPER, APEPER, EMAPER, CELPER, TIPPER, FECNACPER) VALUES ('51436952','Luhana','Ortiz Rodriguez','luhana.ortiz@outlook.com','960405017','C','25/11/1980');

/* Actualizar el precio de la Maicena Universal 180 GR a S/. 3.50 */

UPDATE  PRODUCTO
SET PREPRO = '3,5'
WHERE CODPRO = 'P31';

/*Actualizar producto Detergente Opal por Detergente Opal 1/2Kg. */

UPDATE  PRODUCTO
SET NOMPRO = 'Detergente Opal 1/2Kg'
WHERE CODPRO = 'P05';

/*Eliminar físicamente los productos: apanado de pollo y sopa de carne.*/

delete FROM producto
WHERE CODPRO = 'P36';

delete FROM producto
WHERE CODPRO = 'P37';

/*Eliminar físicamente los productos de código P13, P16 y P19.*/

delete FROM producto
WHERE CODPRO = 'P13';

delete FROM producto
WHERE CODPRO = 'P16';

delete FROM producto
WHERE CODPRO = 'P19';
/*Eliminar físicamente todos los productos cuyo precio sea menor e igual a 10.*/

delete FROM producto
WHERE PREPRO < 10.00;

/*Eliminar físicamente la categoría Electrodomésticos.*/

delete FROM CATEGORIA
WHERE IDCAT = 60;


